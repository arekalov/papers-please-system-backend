openapi: 3.0.3

info:
  title: Papers Please API
  description: |
    API for the Papers Please system.
  contact:
    name: arekalov
    email: artyom.rekalov@gmail.com
    url: https://github.com/arekalov
  license:
    name: MIT License
    url: https://opensource.org/licenses/MIT
  version: '1.0'
externalDocs:
  description: "Wiki of Papers Please System"
  url: https://wiki.yandex.ru/homepage/papers-please-system/

servers:
  - url: https://localhost:8080/api/v1
    description: Local development server


tags:
  - name: users
    description: User endpoints
  - name: upks
    description: UPK (checkpoint) endpoints
  - name: shifts
    description: Shift management endpoints



paths:
  /users:
    get:
      tags:
        - users
      summary: Get all users
      description: Returns a list of all users
      parameters:
        - $ref: '#/components/parameters/OffsetParam'
        - $ref: '#/components/parameters/LimitParam'
      responses:
        '200':
          description: A list of users
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UsersListResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
    post:
      tags:
        - users
      summary: Add new user
      description: Create new user and return it
      parameters: 
        - $ref: '#/components/parameters/UserId'
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserRequest'
      responses:
        '200':
          description: New user object
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
  /users/{id}:
    get:
      tags:
        - users    
      summary: Get user by ID
      description: Returns a user by ID
      parameters: 
        - $ref: '#/components/parameters/UserId'
      responses:
        '200':
          description: A user
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
    patch:
      tags:
        - users
      summary: Update some fields of user
      parameters: 
        - $ref: '#/components/parameters/UserId'
      requestBody:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserRequestPartial'
      responses:
        '200':
          description: A user
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserRequest'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
    put:
      tags:
        - users
      summary: Update all userData
      parameters: 
        - $ref: '#/components/parameters/UserId'
      requestBody:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserRequest'
      responses:
        '200':
          description: New user object
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
    delete:
      tags:
        - users
      summary: Path any field in user object
      parameters: 
        - $ref: '#/components/parameters/UserId'
      responses:
        '200':
          description: A user
          content: 
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
  
  /upks:
    get:
      tags:
        - upks
      summary: Get all UPKs
      description: Returns a list of all checkpoints
      parameters:
        - $ref: '#/components/parameters/OffsetParam'
        - $ref: '#/components/parameters/LimitParam'
        - name: region
          in: query
          required: false
          schema:
            $ref: '#/components/schemas/Region'
          description: Filter by region
        - $ref: '#/components/parameters/BossIdQueryParam'
      responses:
        '200':
          description: A list of UPKs
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UpksListResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
    post:
      tags:
        - upks
      summary: Create new UPK
      description: Create new checkpoint and return it
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpkRequest'
      responses:
        '201':
          description: Created UPK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UpkResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '409':
          $ref: '#/components/responses/Conflict'
  
  /upks/{id}:
    get:
      tags:
        - upks
      summary: Get UPK by ID
      description: Returns a checkpoint by ID
      parameters:
        - $ref: '#/components/parameters/UpkId'
      responses:
        '200':
          description: A UPK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UpkResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
    put:
      tags:
        - upks
      summary: Update UPK
      description: Full update of checkpoint
      parameters:
        - $ref: '#/components/parameters/UpkId'
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpkRequest'
      responses:
        '200':
          description: Updated UPK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UpkResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
    patch:
      tags:
        - upks
      summary: Partially update UPK
      description: Partial update of checkpoint fields
      parameters:
        - $ref: '#/components/parameters/UpkId'
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpkRequestPartial'
      responses:
        '200':
          description: Updated UPK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UpkResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
    delete:
      tags:
        - upks
      summary: Delete UPK
      description: Delete checkpoint by ID
      parameters:
        - $ref: '#/components/parameters/UpkId'
      responses:
        '204':
          description: UPK deleted successfully
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
  
  /shifts:
    get:
      tags:
        - shifts
      summary: Get all shifts
      description: Returns a list of all shifts
      parameters:
        - $ref: '#/components/parameters/OffsetParam'
        - $ref: '#/components/parameters/LimitParam'
        - $ref: '#/components/parameters/UpkIdQueryParam'
        - $ref: '#/components/parameters/ShiftDateParam'
        - $ref: '#/components/parameters/CreatedByParam'
      responses:
        '200':
          description: A list of shifts
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ShiftsListResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
    post:
      tags:
        - shifts
      summary: Create new shift
      description: Create new shift and return it
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ShiftRequest'
      responses:
        '201':
          description: Created shift
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ShiftResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
  
  /shifts/{id}:
    get:
      tags:
        - shifts
      summary: Get shift by ID
      description: Returns a shift by ID
      parameters:
        - $ref: '#/components/parameters/ShiftId'
      responses:
        '200':
          description: A shift
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ShiftResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
    put:
      tags:
        - shifts
      summary: Update shift
      description: Full update of shift
      parameters:
        - $ref: '#/components/parameters/ShiftId'
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ShiftRequest'
      responses:
        '200':
          description: Updated shift
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ShiftResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
    patch:
      tags:
        - shifts
      summary: Partially update shift
      description: Partial update of shift fields
      parameters:
        - $ref: '#/components/parameters/ShiftId'
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ShiftRequestPartial'
      responses:
        '200':
          description: Updated shift
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ShiftResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
    delete:
      tags:
        - shifts
      summary: Delete shift
      description: Delete shift by ID
      parameters:
        - $ref: '#/components/parameters/ShiftId'
      responses:
        '204':
          description: Shift deleted successfully
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

components:
  responses:
    BadRequest:
      description: Bad Request - Invalid input data
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            code: 'INVALID_INPUT'
            message: 'Invalid input data provided'
    Unauthorized:
      description: Unauthorized - Missing or invalid authentication
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            code: 'UNAUTHORIZED'
            message: 'Authentication token is missing or invalid'
    Forbidden:
      description: Forbidden - Insufficient permissions
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            code: 'FORBIDDEN'
            message: 'You do not have permission to access this resource'
    NotFound:
      description: Not Found - Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            code: 'NOT_FOUND'
            message: 'The requested resource was not found'
    Conflict:
      description: Conflict - Resource already exists
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            code: 'CONFLICT'
            message: 'Resource with this identifier already exists'
    InternalError:
      description: Internal Server Error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            code: 'INTERNAL_ERROR'
            message: 'An unexpected error occurred. Please try again later.'
  parameters:
    UserId:
      name: id
      in: path
      required: true
      schema:
        type: string
        example: '520e073f-a2c3-40d4-a6ce-5ef72ba90b90'
    UpkId:
      name: id
      in: path
      required: true
      schema:
        type: string
        format: uuid
        example: 'f47ac10b-58cc-4372-a567-0e02b2c3d479'
    ShiftId:
      name: id
      in: path
      required: true
      schema:
        type: string
        format: uuid
        example: 'a1b2c3d4-e5f6-7890-abcd-ef1234567890'
    UpkIdQueryParam:
      name: upk_id
      in: query
      required: false
      schema:
        type: string
        format: uuid
      description: Filter by UPK ID
    ShiftDateParam:
      name: shift_date
      in: query
      required: false
      schema:
        type: string
        format: date-time
      description: Filter by shift date
    CreatedByParam:
      name: created_by
      in: query
      required: false
      schema:
        type: string
        format: uuid
      description: Filter by creator ID
    RoleIdQueryParam:
      name: role_id
      in: query
      required: false
      schema:
        type: integer
      description: Filter by role ID
    BossIdQueryParam:
      name: boss_id
      in: query
      required: false
      schema:
        type: string
        format: uuid
      description: Filter by boss ID
    OffsetParam:
      name: offset
      in: query
      required: false
      schema:
        type: integer
        minimum: 0
        default: 0
        example: 0
    LimitParam:
      name: limit
      in: query
      required: false
      schema:
        type: integer
        minimum: 1
        maximum: 100
        default: 20
        example: 20
  schemas:
    ErrorResponse:
        type: object
        properties:
          code:
            type: string
            description: Machine-readable error code
            example: 'USER_NOT_FOUND'
          message:
            type: string
            description: Human-readable error message
            example: 'User with id 520e073f-a2c3-40d4-a6ce-5ef72ba90b90 not found'
        required:
          - code
          - message
    UserResponse:
      type: object
      properties:
        id:
          type: string
          example: '520e073f-a2c3-40d4-a6ce-5ef72ba90b90'
        name:
          type: string
          example: 'Ivan Ivanov'
        email:
          type: string
          example: 'ivanov@ya.ru'
        role:
          $ref: '#/components/schemas/Role'
          example: migrant
        upkId:
          type: string
          example: 'b50cbfb0-bcf9-4808-bcb1-f2024af7f2e1'
      required:
        - id
        - name
        - email
        - role
    UsersListResponse:
      type: object
      properties:
        total:
          type: integer
          example: 100
        limit:
          type: integer
          minimum: 0
          maximum: 100
          example: 20
        offset:
          type: integer
          minimum: 0
        items:
          type: array
          $ref: '#/components/schemas/UserResponse'
    UserRequest: 
      type: object
      properties:
        name:
          type: string
          example: 'Ivan Ivanov'
        email:
          type: string
          example: 'ivanov@ya.ru'
        role:
          $ref: '#/components/schemas/Role'
          example: migrant
        upkId:
          type: string
          example: 'b50cbfb0-bcf9-4808-bcb1-f2024af7f2e1'
      required:
        - name
        - email
        - role
    UserRequestPartial:
      type: object
      properties:
        name:
          type: string
          example: 'Ivan Ivanov'
        email:
          type: string
          example: 'ivanov@ya.ru'
        role:
          $ref: '#/components/schemas/Role'
          example: migrant
        upkId:
          type: string
          example: 'b50cbfb0-bcf9-4808-bcb1-f2024af7f2e1'
    Role:
      type: string
      enum:
        - migrant
        - inspector 
        - boss
        - security
        - god
    Region:
      type: string
      enum:
        - Orvech_Vonor
        - East_Grestin
        - Paradizna
    UpkResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: 'f47ac10b-58cc-4372-a567-0e02b2c3d479'
        name:
          type: string
          example: 'East Grestin Checkpoint'
        bossId:
          type: string
          format: uuid
          example: '520e073f-a2c3-40d4-a6ce-5ef72ba90b90'
        region:
          $ref: '#/components/schemas/Region'
      required:
        - id
        - name
        - bossId
        - region
    UpkRequest:
      type: object
      properties:
        name:
          type: string
          example: 'East Grestin Checkpoint'
        bossId:
          type: string
          format: uuid
          example: '520e073f-a2c3-40d4-a6ce-5ef72ba90b90'
        region:
          $ref: '#/components/schemas/Region'
      required:
        - name
        - bossId
        - region
    UpkRequestPartial:
      type: object
      properties:
        name:
          type: string
          example: 'East Grestin Checkpoint'
        bossId:
          type: string
          format: uuid
          example: '520e073f-a2c3-40d4-a6ce-5ef72ba90b90'
        region:
          $ref: '#/components/schemas/Region'
    UpksListResponse:
      type: object
      properties:
        total:
          type: integer
          example: 10
        limit:
          type: integer
          minimum: 0
          maximum: 100
          example: 20
        offset:
          type: integer
          minimum: 0
          example: 0
        items:
          type: array
          items:
            $ref: '#/components/schemas/UpkResponse'
      required:
        - total
        - limit
        - offset
        - items
    ShiftResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: 'a1b2c3d4-e5f6-7890-abcd-ef1234567890'
        shiftDate:
          type: string
          format: date-time
          example: '2024-06-01T08:00:00Z'
        createdBy:
          type: string
          format: uuid
          example: '520e073f-a2c3-40d4-a6ce-5ef72ba90b90'
        upkId:
          type: string
          format: uuid
          example: 'f47ac10b-58cc-4372-a567-0e02b2c3d479'
      required:
        - id
        - shiftDate
        - createdBy
        - upkId
    ShiftRequest:
      type: object
      properties:
        shiftDate:
          type: string
          format: date-time
          example: '2024-06-01T08:00:00Z'
        createdBy:
          type: string
          format: uuid
          example: '520e073f-a2c3-40d4-a6ce-5ef72ba90b90'
        upkId:
          type: string
          format: uuid
          example: 'f47ac10b-58cc-4372-a567-0e02b2c3d479'
      required:
        - shiftDate
        - createdBy
        - upkId
    ShiftRequestPartial:
      type: object
      properties:
        shiftDate:
          type: string
          format: date-time
          example: '2024-06-01T08:00:00Z'
    ShiftsListResponse:
      type: object
      properties:
        total:
          type: integer
          example: 50
        limit:
          type: integer
          minimum: 0
          maximum: 100
          example: 20
        offset:
          type: integer
          minimum: 0
          example: 0
        items:
          type: array
          items:
            $ref: '#/components/schemas/ShiftResponse'
      required:
        - total
        - limit
        - offset
        - items
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
